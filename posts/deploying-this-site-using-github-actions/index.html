<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Deploying this site using GitHub Actions - ðŸš€ Bintang Pradana Erlangga Putra</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="(not) A guide to deploying a Hugo site using GitHub Actions" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="/posts/deploying-this-site-using-github-actions/">
  <meta property="og:site_name" content="ðŸš€ Bintang Pradana Erlangga Putra">
  <meta property="og:title" content="Deploying this site using GitHub Actions">
  <meta property="og:description" content="(not) A guide to deploying a Hugo site using GitHub Actions">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-21T17:50:45+07:00">
    <meta property="article:modified_time" content="2024-06-21T17:50:45+07:00">
    <meta property="article:tag" content="DevOps">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Deploying this site using GitHub Actions">
  <meta name="twitter:description" content="(not) A guide to deploying a Hugo site using GitHub Actions">
<script src="../../js/feather.min.js"></script>
	
	
        <link href="../../css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="../../css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css" media="(prefers-color-scheme: dark)"  />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>
	
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="../../">ðŸš€ Bintang Pradana Erlangga Putra</a>
	</div>
	<nav>
		
		<a href="../../">Home</a>
		
		<a href="../../posts">Posts</a>
		
		<a href="../../about">About</a>
		
		<a href="../../tags">Tags</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Deploying this site using GitHub Actions</h1>
			<div class="meta">Posted on Jun 21, 2024</div>
		</div>
		
		<div class="tldr">
			<strong>tl;dr:</strong>
			Don&#39;t follow this guide, it&#39;s a mess.
		</div>

		<section class="body">
			<h2 id="why">Why?</h2>
<p>I was bored at work and I thought, <strong>&ldquo;Hey, why not automate the deployment of this site using GitHub Actions? But I don&rsquo;t want the easy way, I want to do it the hard way.&rdquo;</strong>. I like torturing myself, so I did it the hard way. And now I&rsquo;m writing about it.</p>
<p>Before we start, let me tell you that <strong>this is not a guide. This is a mess.</strong> I&rsquo;m just documenting what I did so that I can look back and laugh at myself. If you&rsquo;re looking for a guide, you&rsquo;re in the wrong place. But if you&rsquo;re looking for a mess, you&rsquo;re in the right place.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You need to have a Hugo site. If you don&rsquo;t have one, go build one. It&rsquo;s easy. You also need to have a GitHub account. If you don&rsquo;t have one, go create one. It&rsquo;s free. You also need to have a domain. If you don&rsquo;t have one, go buy one. It&rsquo;s cheap. Lastly, you need to have a VPS. If you don&rsquo;t have one, go rent one. It&rsquo;s only $5 a month. There&rsquo;s no excuse.</p>
<h2 id="prepare-for-the-mess">Prepare for the Mess</h2>
<h3 id="creating-hugo-site">Creating Hugo Site</h3>
<p>I&rsquo;m not going to explain how to create a Hugo site in detail. There are plenty of guides out there. Just follow one of them. Or don&rsquo;t. It&rsquo;s up to you.
Basically, you need to install Hugo by running <code>brew install hugo</code>, create a new site by running <code>hugo new site my-site</code>, and you&rsquo;re good to go.</p>
<h3 id="setting-up-github-repository">Setting Up GitHub Repository</h3>
<p>Do I really need to explain this? Just create a new repository on GitHub and push your Hugo site to it. It&rsquo;s easy. If you don&rsquo;t know how to do it, you shouldn&rsquo;t be reading this.</p>
<h3 id="buy-a-domain">Buy a Domain</h3>
<p>I&rsquo;m using Hostinger. Why Hostinger? I don&rsquo;t know, don&rsquo;t ask me. Just go buy a domain.</p>
<h3 id="connecting-to-cloudflare">Connecting to CloudFlare</h3>
<p>To be honest I forgot how to do this step. Just google how to setup CloudFlare tunnel.</p>
<h3 id="setting-up-vps">Setting Up VPS</h3>
<p>I&rsquo;m using a VPS from Biznet Gio. It&rsquo;s only $5 a month. I&rsquo;m using Debian 11. You can use whatever you want.</p>
<p>Make sure you have Docker installed. This <a href="https://docs.docker.com/compose/install/linux/#install-using-the-repository">page</a> has a good guide on how to install Docker.</p>
<p>Don&rsquo;t forget to put your SSH public key in <code>~/.ssh/authorized_keys</code> so that the GitHub Actions can SSH into your VPS.</p>
<p>And lastly go to your CloudFlare Zero Trust Dashboard, go to <code>Networks</code> -&gt; <code>Tunnels</code> -&gt; <code>Create a tunnel</code> and follow the instructions.
After that go to <code>Public Hostname</code> tab and select <code>Add a public hostname</code>. I&rsquo;m using <code>blog.bpradana.xyz</code> as the hostname, and in the service section you have to select <code>HTTPS</code> as the type and <code>localhost:80</code> as the URL (I&rsquo;m using port 80 but you can change it)</p>
<h3 id="setting-up-github-actions">Setting Up GitHub Actions</h3>
<p>This is where the fun begins. I created a new workflow file in <code>.github/workflows/vps.yml</code> with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">master</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build-upload</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build and upload Docker image</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout repository</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Set up Docker Buildx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">docker/setup-buildx-action@v1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build and push</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">docker/build-push-action@v2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">context</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">file</span>: <span style="color:#ae81ff">./Dockerfile</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">platforms</span>: <span style="color:#ae81ff">linux/amd64,linux/arm64</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">push</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">tags</span>: <span style="color:#ae81ff">${{ secrets.REGISTRY_HOST }}/${{ secrets.USERNAME }}/site:latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy to VPS</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: <span style="color:#ae81ff">build-upload</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">appleboy/ssh-action@master</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">host</span>: <span style="color:#ae81ff">${{ secrets.HOST }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">username</span>: <span style="color:#ae81ff">${{ secrets.USER }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">key</span>: <span style="color:#ae81ff">${{ secrets.SSH_PRIVATE_KEY }}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker pull ${{ secrets.REGISTRY_HOST }}/${{ secrets.USERNAME }}/site:latest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker stop site || true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker rm site || true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            docker run -d --name site -p 80:80 ${{ secrets.REGISTRY_HOST }}/${{ secrets.USERNAME }}/site:latest</span>            
</span></span></code></pre></div><p>Let me explain what this mess does:</p>
<ol>
<li>It builds a Docker image and pushes it to a Docker registry. It checks out the repository, sets up Docker Buildx, builds the Docker image, and pushes it to the Docker registry.</li>
<li>It deploys the Docker image to the VPS. It pulls the Docker image, stops the existing container, removes the existing container, and runs a new container.</li>
</ol>
<h3 id="setting-up-secrets">Setting Up Secrets</h3>
<p>You need to set up some secrets in your GitHub repository. Go to <code>Settings</code> -&gt; <code>Secrets</code> -&gt; <code>New repository secret</code> and add the following secrets:</p>
<ul>
<li><code>REGISTRY_HOST</code>: The hostname of your Docker registry.</li>
<li><code>USERNAME</code>: Your Docker registry username.</li>
<li><code>HOST</code>: The hostname of your VPS.</li>
<li><code>USER</code>: The username of your VPS.</li>
<li><code>SSH_PRIVATE_KEY</code>: Your private key.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>That&rsquo;s it. You now have a mess. Congratulations! If you followed this mess, you&rsquo;re a brave soul. If you didn&rsquo;t, you&rsquo;re a smart person. Either way, I hope you enjoyed this mess. I know I did. Now go automate something else. Have fun!</p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="../../%20/tags/devops">DevOps</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://twitter.com/bintang_pradana/" rel="me" title="Twitter"><i data-feather="twitter"></i></a>
    <a class="border"></a><a class="soc" href="https://github.com/bpradana/" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://linkedin.com/in/bpradana" rel="me" title="LinkedIn"><i data-feather="linkedin"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2025  Â© Bintang Pradana Erlangga Putra |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
